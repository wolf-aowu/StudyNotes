# pandas

## 介绍

pandas 模块是基于 NumPy 模块的一个开源 Python 模块，广泛应用于完成数据快速分析、数据清洗和准备等工作，它的名字来源于 “panel data”（面板数据）。pandas 模块提供了非常直观的数据结构及强大的数据管理和数据处理功能，某种程度上可以把 pandas 模块看成 Python 版的 Excel。

与 NumPy 模块相比，pandas 模块更擅长处理二维数据，其主要有 Series 和 DataFrame 两种数据结构。

## 安装

在命令提示符中：

```shell
pip install pandas
```

如果需要读取 Excel 工作簿，需要在命令提示符中安装 openpyxl 模块。

```shell
pip install openpyxl
```

## 数据结构

### Series

Series 类似于通过 NumPy 模块创建的一维数组，不同的是 Series 对象不仅包含数值，还包含一组索引。

``` python
import pandas as pd
s = pd.Series(['丁一', '王二', '张三'])
print(s)
print(s[0])
```

输出：

```python
0    丁一
1    王二
2    张三
dtype: object
丁一
```

### DataFrame

DataFrame 是一种二维表格数据结构，可以将其看成一个 Excel 表格。它有行索引和列索引，可以自定义。默认索引序号是从 0 开始的。

`pd.DataFrame()` 共有 5 个参数：data、index、columns、dtype、copy。

index 用于指定行索引名称。columns 用于指定列索引名称。

```python
import pandas as pd
d = pd.DataFrame([[1, 2], [3, 4], [5, 6]])
print(d)
d = pd.DataFrame([[1, 2], [3, 4], [5, 6]], index=['A', 'B', 'C'], columns=['date', 'score'])
print(d)
```

输出：

```python
   0  1
0  1  2
1  3  4
2  5  6

   date  score
A     1      2
B     3      4
C     5      6
```

另一种 DataFrame 创建方式。必须保证列表 date 和 score 的长度一致，否则会报错。

```python
import pandas as pd
d = pd.DataFrame()
date = [1, 3, 5]
score = [2, 4, 6]
d['date'] = date
d['score'] = score
print(d)
```

输出：

```python
   date  score
0     1      2
1     3      4
2     5      6
```

#### 通过字典创建 DataFrame

通过字典创建 DataFrame，默认以字典的键名作为列索引。可以使用 `from_dict()` 设置参数 orient 的值为 'index'，以字典键名作为行索引。参数 orient 用于指定以字典的键名作为列索引还是行索引，默认值为 'columns'，即以字典的键名作为列索引，如果设置成 'index'，则表示以字典的键名作为行索引。

```python
import pandas as pd
d = pd.DataFrame({'a': [1, 3, 5], 'b': [2, 4, 6]}, index=['x', 'y', 'z'])
print(d)

d = pd.DataFrame.from_dict({'a': [1, 3, 5], 'b': [2, 4, 6]}, orient='index')
print(d)
```

输出：

```python
   a  b
x  1  2
y  3  4
z  5  6

   0  1  2
a  1  3  5
b  2  4  6
```

#### 通过二位数组创建 DataFrame

```python
import numpy as np
import pandas as pd
a = np.arange(12).reshape(3, 4)
d = pd.DataFrame(a, index=[1, 2, 3], columns=['A', 'B', 'C', 'D'])
print(d)
```

输出：

```python
   A  B   C   D
1  0  1   2   3
2  4  5   6   7
3  8  9  10  11
```

## DataFrame 索引修改

### 修改索引那一列名称

使用 `index.name` 属性。

```python
import pandas as pd
a = np.arange(12).reshape(3, 4)
d = pd.DataFrame(a, index=[1, 2, 3], columns=['A', 'B', 'C', 'D'])
d.index.name = '公司'
print(d)
```

输出：

``` python
    A  B   C   D
公司
1   0  1   2   3
2   4  5   6   7
3   8  9  10  11
```

### 重命名索引

使用 `rename()` 函数，该函数会用新索引名创建一个新的 DataFrame，并不会改变 d 的内容，所以这里将重命名索引之后得到的新 DataFrame 赋给 d，以便在后续代码中使用。也可以通过设置参数 inplace 为 True 来一步到位地完成索引的重命名。

```python
import pandas as pd
a = np.arange(6).reshape(3, 2)
d = pd.DataFrame(a, index=['A', 'B', 'C'], columns=['date', 'score'])
print(d)
print(id(d))
d = d.rename(index={'A': '万科', 'B': '阿里', 'C': '百度'},
             columns={'date': '日期', 'score': '分数'})
print(d)
print(id(d))
d.rename(index={'万科': '爸爸', '阿里': '妈妈', '百度': '老王'}, inplace=True)
print(d)
print(id(d))
```

输出：

```python
   date  score
A     0      1
B     2      3
C     4      5
1507889511872
    日期  分数
万科   0   1
阿里   2   3
百度   4   5
1507889512304
    日期  分数
爸爸   0   1
妈妈   2   3
老王   4   5
1507889512304
```

### 行索引转换为常规列

使用 `reset_index()` 函数重置索引，也是得到一个新的 DataFrame。也可以通过设置参数 inplace 为 True 来一步到位地完成索引转换为常规列。

```python
import pandas as pd
a = np.arange(6).reshape(3, 2)
d = pd.DataFrame(a, index=['A', 'B', 'C'], columns=['date', 'score'])
d = d.rename(index={'A': '万科', 'B': '阿里', 'C': '百度'},
             columns={'date': '日期', 'score': '分数'})
d.index.name = '公司'
print(d)
print(id(d))
d = d.reset_index()
print(d)
print(id(d))
d.reset_index(inplace=True)
print(d)
print(id(d))
```

输出：

```python
    日期  分数
公司
万科   0   1
阿里   2   3
百度   4   5
2340460531712
   公司  日期  分数
0  万科   0   1
1  阿里   2   3
2  百度   4   5
2340460531904
   index  公司  日期  分数
0      0  万科   0   1
1      1  阿里   2   3
2      2  百度   4   5
2340460531904
```

### 将常规列转换为行索引

使用 `set_index()` 函数，也是得到一个新的 DataFrame。也可以通过设置参数 inplace 为 True 来一步到位地完成索引转换为常规列。如果已经存在行索引，它会替换掉行索引，也就是旧的行索引被删除掉了。

```python
import pandas as pd
a = np.arange(6).reshape(3, 2)
d = pd.DataFrame(a, index=['A', 'B', 'C'], columns=['date', 'score'])
d = d.rename(index={'A': '万科', 'B': '阿里', 'C': '百度'},
             columns={'date': '日期', 'score': '分数'})
d.index.name = '公司'
d = d.reset_index()
print(d)
print(id(d))
d = d.set_index('公司')
print(d)
print(id(d))
d.set_index('日期', inplace=True)
print(d)
print(id(d))
```

输出：

```python
   公司  日期  分数
0  万科   0   1
1  阿里   2   3
2  百度   4   5
2243967935168
    日期  分数
公司
万科   0   1
阿里   2   3
百度   4   5
2243966050576
    分数
日期
0    1
2    3
4    5
2243966050576
```

## 文件的读取和写入

通过 pandas 模块可以从多种格式的数据文件中读取数据，也可以将处理后的数据写入这些文件中。

### Excel 文件读取

使用 `pd.read_excel()` 函数，该函数有需要多参数可以使用。

常用的参数：

1. *sheet_name*：用于指定工作表，可以是工作表名称，也可以是数字（默认为0，即第1个工作表）。
2. index_col：用于设置索引列。

```python
import pandas as pd
data = pd.read_excel('基本操作\分公司.xlsx', sheet_name=0)
print(data)
```

输出：

```python
   编号 子公司
0   1  华为
1   2  百度
2   3  腾讯
```

### CSV 文件读取

CSV 文件本质上是一个文本文件，它仅存储数据，不能像 Excel 工作簿那样存储格式、公式、宏等信息，所以所占存储空间通常较小。CSV 文件一般用逗号分隔一系列值，既可以用 Excel 打开，也可以用文本编辑器（如记事本）打开。

使用 `pd.read_csv()` 函数。

常用的参数：

1. delimiter：用于指定 CSV 文件的数据分隔符，默认为逗号。与字符串的 `split()` 函数一个道理。不要理解错了，是把指定字符切掉，不是增加分割符。
2. encoding：用于指定文件的编码方式，一般设置为 UTF-8 或 GBK 编码，以避免中文乱码。
3. index_col：用于设置索引列。

```python
import pandas as pd
data = pd.read_csv('基本操作\分公司.csv', delimiter='为',
                   engine='python', encoding='utf-8')
print(data)
```

输出：

```python
      编号,子公司
1,华      NaN
2,百度     NaN
3,腾讯     NaN
```

### 写入 Excel 文件

使用 `to_excel` 函数。会将工作簿中原有的 sheet 替换掉。

常用的参数：

1. sheet_name：用于指定工作表名称。
2. index：用于指定是否写入行索引信息，默认为 True，即将行索引信息存储在输出文件的第 1 列；若设置为 False，则忽略行索引信息。
3. columns：用于指定要写入的列。

```python
import pandas as pd
data = pd.DataFrame([[1, 2], [3, 4], [5, 6]], columns=['A列', 'B列'])
data.to_excel('基本操作\分公司.xlsx', sheet_name='练习', index=False)
```

输出：

![](图片\写入 Excel.png)

### 写入 csv 文件